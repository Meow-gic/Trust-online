<script>
    function validateAndCalculateResults() {
        const requiredFields = [
            { id: 'trustShares', name: '交付信託張數' },
            { id: 'trustYears', name: '信託規劃年數' },
            { id: 'stockCode', name: '交付股票代號' },
            { id: 'stockPrice', name: '股價' },
            { id: 'futureStockPrice', name: '預估未來股價' },
            { id: 'futureEarningsShares', name: '預估未來盈餘配股' },
            { id: 'futureCashDividend', name: '預估未來現金股利' }
        ];

        for (let field of requiredFields) {
            const value = document.getElementById(field.id).value;
            if (!value) {
                alert(`請填寫 ${field.name}`);
                return;
            }
        }

        calculateResults();
    }

    function calculateResults() {
        // 收集用户输入的数据
        const trustShares = parseFloat(document.getElementById('trustShares').value) || 0;
        const trustYears = parseFloat(document.getElementById('trustYears').value) || 0;
        const stockPrice = parseFloat(document.getElementById('stockPrice').value) || 0;

        // 计算信託本金
        const trustPrincipal = trustShares * 1000 * stockPrice;

        // 计算股利收入
        const futureStockPrice = parseFloat(document.getElementById('futureStockPrice').value) || 0;
        const futureEarningsShares = parseFloat(document.getElementById('futureEarningsShares').value) || 0;
        const futureCashDividend = parseFloat(document.getElementById('futureCashDividend').value) || 0;
        const dividendIncome = futureEarningsShares * futureStockPrice + futureCashDividend * trustShares;

        // 计算應繳贈與稅 (E5 - F5)
        const F5 = 2440000;
        const E5 = trustPrincipal - trustPrincipal / Math.pow(1 + 0.01725, trustYears);
        let giftTax;
        if (E5 - F5 <= 25000000) {
            giftTax = (E5 - F5) * 0.1;
        } else if (E5 - F5 <= 50000000) {
            giftTax = (E5 - F5) * 0.15 - 1250000;
        } else {
            giftTax = (E5 - F5) * 0.2 - 3750000;
        }
        giftTax = giftTax < 0 ? 0 : giftTax;

        // 计算最多可省稅金
        const maxTaxSavings = giftTax;

        // 显示结果
        const resultData = `
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="background-color: #5F97D1; color: #FFFFFF;">
                    <td style="padding: 10px; font-weight: bold;">信託本金</td>
                    <td style="padding: 10px;">${trustPrincipal.toLocaleString()} 元</td>
                </tr>
                <tr style="background-color: #D9EAF7;">
                    <td style="padding: 10px; font-weight: bold;">股利收入</td>
                    <td style="padding: 10px;">${dividendIncome.toLocaleString()} 元</td>
                </tr>
                <tr style="background-color: #F5F5F5;">
                    <td style="padding: 10px; font-weight: bold;">應繳贈與稅</td>
                    <td style="padding: 10px;">${giftTax.toLocaleString()} 元</td>
                </tr>
                <tr style="background-color: #e55347; color: #FFFFFF;">
                    <td colspan="2" style="padding: 15px; text-align: center; font-weight: bold;">最多可省下 ${maxTaxSavings.toLocaleString()} 元</td>
                </tr>
            </table>
            <div style="margin-top: 15px; padding: 10px; background-color: #FFF4E5; border-left: 5px solid #FFA500;">
                <p style="margin: 0; font-size: 14px; color: #333;">
                    <strong>!</strong> 贈與稅試算僅供參考，實際應繳稅額仍依據當年度個人贈與情況決定
                </p>
            </div>
        `;
        document.getElementById('result').innerHTML = `<h2>查詢結果</h2>${resultData}`;
    }
</script>
